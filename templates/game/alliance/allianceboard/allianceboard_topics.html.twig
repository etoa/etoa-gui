{% extends 'game/alliance/allianceboard/allianceboard.html.twig' %}
{% import 'macros.html.twig' as macros %}
{% set topics = allianceBoardTopicRepository.getTopics(category.id) %}

{% block allianceboard %}
    <h2>
        <a href="{{ path('game.alliance.allianceboard.overview') }}">Übersicht</a>>{{ category.name }}
    </h2>
    {% if topics %}
        <twig:Table>
        {% block table_content %}
            <tr>
                <th colspan="2">Thema</th>
                <th>Posts</th>
                <th>Aufrufe</th>
                <th>Autor</th>
                <th>Letzter Beitrag</th>
                {% if isAdmin %}
                    <th>Aktionen</th>
                {% endif %}
            </tr>
            {% for topic in topics %}
                <tr>
                    <td style="width:37px;">
                        {% if topic.top %}
                            <img src="{{ asset('build/images/sticky.gif') }}" alt="top" style="width:22px;height:15px;"{{ tm("
                                 Wichtiges Thema", "Dieses ist ein wichtiges Thema.") }}/>
                        {% endif %}
                        {% if topic.top %}
                            <img src="{{ asset('build/images/closed.gif') }}" alt="closed" style="width:15px;height:16px;"
                            {{tm("Geschlossen", "Es können keine weiteren Beiträge zu diesem Thema geschrieben werden.")}} />
                        {% endif %}
                    </td>
                    <td style="width:250px;">
                        <a href="{{ path('game.alliance.allianceboard.showposts',{id:topic.id}) }}">{{ topic.subject }}</a>
                    </td>
                    <td>{{ allianceBoardPostRepository.getPosts(topic.id)|length }}</td>
                    <td>{{ topic.count }}</td>
                    <td>{{ allianceUsers[topic.userId].getNick }}</td>
                    <td>
                        {% if  allianceBoardPostRepository.getPosts(topic.id, 1) %}
                            {{ formatTimestamp(allianceBoardPostRepository.getPosts(topic.id, 1)[0].timestamp) }}<br/>{{ allianceBoardPostRepository.getPosts(topic.id, 1)[0].userNick }}
                        {% else %}
                            Keine Einträge vorhanden
                        {% endif %}
                    </td>
                    {% if isAdmin or app.user.id == topic.userId %}
                        <td style="vertical-align:middle;text-align:center;">
                            <a href="{{ path('game.alliance.allianceboard.edittopic',{'id':topic.id}) }}" title="Thema bearbeiten">{{ icon("edit")|raw }}</a>
                            {% if isAdmin %}
                                <a href="{{ path('game.alliance.allianceboard.deletetopic',{'id':topic.id}) }}" title="Thema löschen">{{ icon("delete")|raw }}</a>
                            {% endif %}
                        </td>
                    {% endif %}
                </tr>
            {% endfor %}
        {% endblock %}
        </twig:Table>
    {% else %}
        {{ macros.errorMessage('Es sind noch keine Themen vorhanden!') }}
    {% endif %}
    <a href="{{ path('game.alliance.allianceboard.newtopic',{'id':category.id}) }}">
        <input type="button" value="Neues Thema"/>&nbsp;
    </a>
    <a href="{{ path('game.alliance.allianceboard.overview') }}">
        <input type="button" value="Zur Übersicht"/>
    </a>
{% endblock %}